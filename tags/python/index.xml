<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Python on Mohamed Attia's Macrocosm</title><link>https://mohamed.computer/tags/python/</link><description>Recent content in Python on Mohamed Attia's Macrocosm</description><generator>Hugo</generator><language>en-us</language><copyright>©️ Mohamed Attia</copyright><lastBuildDate>Sat, 23 Mar 2024 00:00:00 +0000</lastBuildDate><atom:link href="https://mohamed.computer/tags/python/index.xml" rel="self" type="application/rss+xml"/><item><title>Barebones python project with a virtual environment in Emacs Lisp</title><link>https://mohamed.computer/posts/elisp-python-project-init/</link><pubDate>Sat, 23 Mar 2024 00:00:00 +0000</pubDate><guid>https://mohamed.computer/posts/elisp-python-project-init/</guid><description>&lt;p&gt;A lot of the time I find myself wanting to have a directory with a basic Python virtual environment initialized in it,
so I wrote the following Emacs Lisp script to do that, you can use it as an interactive function in emacs or as a script that you call from a shell.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Remember to change the path and the keybinding to your liking&lt;/strong&gt;&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-elisp" data-lang="elisp"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style=""&gt;#&lt;/span&gt;&lt;span style="color:#bb60d5"&gt;!&lt;/span&gt; &lt;span style="color:#bb60d5"&gt;emacs&lt;/span&gt; &lt;span style="color:#bb60d5"&gt;--script&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#60a0b0;font-style:italic"&gt;;;; Code:&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;(&lt;span style="color:#007020"&gt;defun&lt;/span&gt; &lt;span style="color:#bb60d5"&gt;setup-python-project-in-directory&lt;/span&gt; (&lt;span style="color:#bb60d5"&gt;project-name&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#4070a0"&gt;&amp;#34;Setup a Python project at PROJECT-NAME with a virtual environment.&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; (&lt;span style="color:#007020"&gt;interactive&lt;/span&gt; (&lt;span style="color:#06287e"&gt;list&lt;/span&gt; (&lt;span style="color:#06287e"&gt;read-string&lt;/span&gt; &lt;span style="color:#4070a0"&gt;&amp;#34;Enter the project name: &amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#4070a0"&gt;&amp;#34;frobenius&amp;#34;&lt;/span&gt;)))
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; (&lt;span style="color:#007020"&gt;let*&lt;/span&gt; ((&lt;span style="color:#bb60d5"&gt;project-dir&lt;/span&gt; (&lt;span style="color:#06287e"&gt;concat&lt;/span&gt; (&lt;span style="color:#06287e"&gt;expand-file-name&lt;/span&gt; &lt;span style="color:#4070a0"&gt;&amp;#34;~&amp;#34;&lt;/span&gt;) &lt;span style="color:#4070a0"&gt;&amp;#34;/personal/python-playground/&amp;#34;&lt;/span&gt; &lt;span style="color:#bb60d5"&gt;project-name&lt;/span&gt;))
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; (&lt;span style="color:#bb60d5"&gt;venv-cmd&lt;/span&gt; (&lt;span style="color:#06287e"&gt;format&lt;/span&gt; &lt;span style="color:#4070a0"&gt;&amp;#34;python3 -m venv %s/.venv --prompt %s&amp;#34;&lt;/span&gt; &lt;span style="color:#bb60d5"&gt;project-dir&lt;/span&gt; &lt;span style="color:#bb60d5"&gt;project-dir&lt;/span&gt;))
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; (&lt;span style="color:#bb60d5"&gt;exists&lt;/span&gt; (&lt;span style="color:#06287e"&gt;file-exists-p&lt;/span&gt; &lt;span style="color:#bb60d5"&gt;project-dir&lt;/span&gt;)))
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; (&lt;span style="color:#007020"&gt;when&lt;/span&gt; &lt;span style="color:#bb60d5"&gt;exists&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; (&lt;span style="color:#007020"&gt;if&lt;/span&gt; (&lt;span style="color:#bb60d5"&gt;y-or-n-p&lt;/span&gt; (&lt;span style="color:#06287e"&gt;format&lt;/span&gt; &lt;span style="color:#4070a0"&gt;&amp;#34;Directory %s exists. Delete and recreate? &amp;#34;&lt;/span&gt; &lt;span style="color:#bb60d5"&gt;project-dir&lt;/span&gt;))
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; (&lt;span style="color:#bb60d5"&gt;delete-directory&lt;/span&gt; &lt;span style="color:#bb60d5"&gt;project-dir&lt;/span&gt; &lt;span style="color:#60add5"&gt;t&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; (&lt;span style="color:#007020"&gt;user-error&lt;/span&gt; &lt;span style="color:#4070a0"&gt;&amp;#34;Process cancelled by the user&amp;#34;&lt;/span&gt;)))
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; (&lt;span style="color:#007020"&gt;unless&lt;/span&gt; &lt;span style="color:#bb60d5"&gt;exists&lt;/span&gt; (&lt;span style="color:#bb60d5"&gt;make-directory&lt;/span&gt; &lt;span style="color:#bb60d5"&gt;project-dir&lt;/span&gt; &lt;span style="color:#60add5"&gt;t&lt;/span&gt;))
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; (&lt;span style="color:#06287e"&gt;message&lt;/span&gt; &lt;span style="color:#4070a0"&gt;&amp;#34;Setting up virtual environment...&amp;#34;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; (&lt;span style="color:#bb60d5"&gt;shell-command&lt;/span&gt; &lt;span style="color:#bb60d5"&gt;venv-cmd&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; (&lt;span style="color:#06287e"&gt;message&lt;/span&gt; (&lt;span style="color:#06287e"&gt;format&lt;/span&gt; &lt;span style="color:#4070a0"&gt;&amp;#34;To activate your virtual environment, run: \n\n source %s/.venv/bin/activate&amp;#34;&lt;/span&gt; &lt;span style="color:#bb60d5"&gt;project-dir&lt;/span&gt;))))
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;(&lt;span style="color:#007020"&gt;when&lt;/span&gt; &lt;span style="color:#bb60d5"&gt;noninteractive&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; (&lt;span style="color:#007020"&gt;let&lt;/span&gt; ((&lt;span style="color:#bb60d5"&gt;project-name&lt;/span&gt; (&lt;span style="color:#06287e"&gt;car&lt;/span&gt; &lt;span style="color:#bb60d5"&gt;command-line-args-left&lt;/span&gt;)))
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; (&lt;span style="color:#007020"&gt;if&lt;/span&gt; (&lt;span style="color:#007020"&gt;or&lt;/span&gt; (&lt;span style="color:#06287e"&gt;null&lt;/span&gt; &lt;span style="color:#bb60d5"&gt;project-name&lt;/span&gt;) (&lt;span style="color:#bb60d5"&gt;string=&lt;/span&gt; &lt;span style="color:#bb60d5"&gt;project-name&lt;/span&gt; &lt;span style="color:#4070a0"&gt;&amp;#34;&amp;#34;&lt;/span&gt;))
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; (&lt;span style="color:#007020"&gt;error&lt;/span&gt; &lt;span style="color:#4070a0"&gt;&amp;#34;No project name provided. Usage: script %s &amp;lt;project-name&amp;gt;&amp;#34;&lt;/span&gt; &lt;span style="color:#bb60d5"&gt;load-file-name&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; (&lt;span style="color:#bb60d5"&gt;setup-python-project-in-directory&lt;/span&gt; &lt;span style="color:#bb60d5"&gt;project-name&lt;/span&gt;))))
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;(&lt;span style="color:#bb60d5"&gt;global-set-key&lt;/span&gt; (&lt;span style="color:#bb60d5"&gt;kbd&lt;/span&gt; &lt;span style="color:#4070a0"&gt;&amp;#34;C-x p y&amp;#34;&lt;/span&gt;) &lt;span style="color:#517918"&gt;&amp;#39;setup-python-project-in-directory&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;(&lt;span style="color:#007020"&gt;provide&lt;/span&gt; &lt;span style="color:#517918"&gt;&amp;#39;setup-python-project-in-directory&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;I haven&amp;rsquo;t bothered to make a proper shebang but check &lt;a href="https://gist.github.com/Kreyren/a12e3618525477c3dd5fb16c3de45bf3#making-emacs-lisp-scripts-executable"&gt;this&lt;/a&gt; out if you&amp;rsquo;re interested in doing that.&lt;/p&gt;</description></item><item><title>Python Internals – CPython Bytecode</title><link>https://mohamed.computer/posts/python-internals-cpython-bytecode/</link><pubDate>Sat, 16 Jun 2018 23:51:11 +0200</pubDate><guid>https://mohamed.computer/posts/python-internals-cpython-bytecode/</guid><description>&lt;p&gt;In this post, I am gonna walk you through compiling python code to CPython bytecode, what code objects are, how to construct them, how to disassemble them, and how to decompile them.&lt;/p&gt;
&lt;p&gt;I will be using CPython 3.6.5.&lt;/p&gt;
&lt;h2 id="a-simple-example"&gt;A simple example&lt;/h2&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-python" data-lang="python"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#666"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; codestr &lt;span style="color:#666"&gt;=&lt;/span&gt; &lt;span style="color:#4070a0"&gt;&amp;#34;&amp;#34;&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#4070a0"&gt;print(&amp;#39;Witness me!&amp;#39;)
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#4070a0"&gt;&amp;#34;&amp;#34;&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#666"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; compiled_codestr &lt;span style="color:#666"&gt;=&lt;/span&gt; &lt;span style="color:#007020"&gt;compile&lt;/span&gt;(codestr, &lt;span style="color:#4070a0"&gt;&amp;#39;&amp;lt;string&amp;gt;&amp;#39;&lt;/span&gt;, &lt;span style="color:#4070a0"&gt;&amp;#39;exec&amp;#39;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#666"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span style="color:#007020"&gt;type&lt;/span&gt;(compiled_codestr)
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#666"&gt;&amp;lt;&lt;/span&gt;&lt;span style="color:#007020;font-weight:bold"&gt;class&lt;/span&gt; &lt;span style=""&gt;&amp;#39;&lt;/span&gt;&lt;span style="color:#0e84b5;font-weight:bold"&gt;code&lt;/span&gt;&lt;span style="color:#4070a0"&gt;&amp;#39;&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Whoo, we have created our first &lt;a href="https://docs.python.org/3.6/c-api/code.html"&gt;code object&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;We passed arguments to the &lt;a href="https://docs.python.org/3/library/functions.html#compile"&gt;compile function&lt;/a&gt; as follows:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt;codestr&lt;/code&gt; is, as you might have guessed, our code as a string.&lt;/p&gt;</description></item></channel></rss>